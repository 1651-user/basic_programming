
  
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Fleet Management</title>
  <style>
    :root{--accent:#2b7cff;--muted:#666;}
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f3f5f7;color:#222;min-height:100vh;}
    header{background:#fff;border-bottom:1px solid #e1e4e8;padding:12px 20px;display:flex;align-items:center;gap:16px;position:sticky;top:0;z-index:3}
    header h2{margin:0;font-size:18px}
    .filters{margin-left:auto;display:flex;gap:12px;align-items:center}
    .filters label{font-size:13px;color:var(--muted);margin-right:6px}
    select, button.filter-clear{padding:6px 8px;border:1px solid #d0d7de;border-radius:4px;background:#fff}
    button.filter-clear{background:#fff;color:var(--muted);cursor:pointer}
    .container{display:flex;gap:18px;padding:18px;align-items:flex-start}
    aside{width:320px;background:#fff;padding:18px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    main{flex:1}
    form label{display:block;margin-top:10px;font-size:13px;color:var(--muted)}
    input[type="text"], select, input[type="checkbox"]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}
    .btn-add{margin-top:12px;padding:10px;border:0;background:var(--accent);color:#fff;border-radius:4px;cursor:pointer;font-weight:600;width:100%}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:8px}
    .card .meta{font-size:13px;color:var(--muted)}
    .card .reg{font-weight:700}
    .card img{width:100%;height:110px;object-fit:cover;border-radius:6px}
    .actions{display:flex;gap:8px;margin-top:6px}
    .actions button{flex:1;padding:8px;border-radius:6px;border:1px solid #d0d7de;background:#fff;cursor:pointer}
    .badge{display:inline-block;padding:4px 8px;border-radius:12px;font-size:12px}
    .avail{background:#e6f4ea;color:#0b6a2a}
    .unavail{background:#fff2f2;color:#a00}
    .empty{grid-column:1/-1;color:#666;padding:12px}
    @media (max-width:1000px){ .grid{grid-template-columns:repeat(2,1fr)} aside{width:260px} }
    @media (max-width:640px){ .container{flex-direction:column} .grid{grid-template-columns:repeat(1,1fr)} aside{width:100%} header{flex-wrap:wrap} }
  </style>
</head>
<body>
  <header>
    <h2>Fleet Admin Dashboard</h2>
    <div class="filters">
      <label for="filterCategory">Category</label>
      <select id="filterCategory" aria-label="Filter by category">
        <option value="All">All</option>
        <option>Auto</option>
        <option>Car</option>
        <option>Truck</option>
        <option>Bus</option>
      </select>

      <label for="filterAvail">Availability</label>
      <select id="filterAvail" aria-label="Filter by availability">
        <option value="All">All</option>
        <option>Available</option>
        <option>Unavailable</option>
      </select>

      <button class="filter-clear" id="clearFilters" title="Reset filters">Clear Filter</button>
    </div>
  </header>

  <div class="container">
    <aside>
      <h3 style="margin:0 0 8px">Add Fleet</h3>
      <form id="fleetForm" novalidate>
        <label for="regNo">Reg No of Vehicle *</label>
        <input id="regNo" name="regNo" type="text" required placeholder="ABC-1234" />

        <label for="category">Category *</label>
        <select id="category" name="category" required>
          <option value="">-- select --</option>
          <option>Auto</option>
          <option>Car</option>
          <option>Truck</option>
          <option>Bus</option>
        </select>

        <label for="driver">Driver Name *</label>
        <input id="driver" name="driver" type="text" required placeholder="Driver name" />

        <label style="margin-top:8px"><input id="isAvailable" name="isAvailable" type="checkbox" checked /> Available</label>

        <button class="btn-add" id="addBtn" type="submit">Add Fleet</button>
      </form>
    </aside>

    <main>
      <h3 style="margin-top:0">Fleet</h3>
      <div id="fleetGrid" class="grid" aria-live="polite"></div>
    </main>
  </div>

  <script>
    (function(){
      const STORAGE_KEY = 'fleetData_v1';
      const defaultImage = 'https://coding-platform.s3.amazonaws.com/dev/lms/tickets/5e80fcb6-3f8e-480c-945b-30a5359eb40e/JNmYjkVr3WOjsrbu.png';
      let fleet = loadData();

      // DOM
      const grid = document.getElementById('fleetGrid');
      const form = document.getElementById('fleetForm');
      const filterCategory = document.getElementById('filterCategory');
      const filterAvail = document.getElementById('filterAvail');
      const clearFiltersBtn = document.getElementById('clearFilters');

      // initial render
      render();

      // handle add via form submit (avoids button vs click issues)
      form.addEventListener('submit', function(e){
        e.preventDefault();
        const reg = document.getElementById('regNo').value.trim();
        const category = document.getElementById('category').value;
        const driver = document.getElementById('driver').value.trim();
        const available = document.getElementById('isAvailable').checked;

        // validation
        if(!reg || !category || !driver){
          alert('Please fill all required fields.');
          return;
        }

        // create & push
        const id = Date.now().toString();
        fleet.push({ id, reg, category, driver, available });
        saveData();

        // clear form and keep checkbox default true
        form.reset();
        document.getElementById('isAvailable').checked = true;

        render();
      });

      // filters
      filterCategory.addEventListener('change', render);
      filterAvail.addEventListener('change', render);
      clearFiltersBtn.addEventListener('click', function(){
        filterCategory.value = 'All';
        filterAvail.value = 'All';
        render();
      });

      // render applies filters and attaches delegated handlers
      function render(){
        grid.innerHTML = '';
        const cat = filterCategory.value;
        const avail = filterAvail.value;

        const filtered = fleet.filter(v => {
          if(cat && cat !== 'All' && v.category !== cat) return false;
          if(avail && avail !== 'All'){
            if(avail === 'Available' && !v.available) return false;
            if(avail === 'Unavailable' && v.available) return false;
          }
          return true;
        });

        if(filtered.length === 0){
          grid.innerHTML = '<div class="empty">No vehicles found.</div>';
          return;
        }

        filtered.forEach(v => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${defaultImage}" alt="vehicle">
            <div class="reg">${escapeHtml(v.reg)}</div>
            <div class="meta">Category: ${escapeHtml(v.category)} â€¢ Driver: <strong>${escapeHtml(v.driver)}</strong></div>
            <div>
              <span class="badge ${v.available ? 'avail' : 'unavail'}">${v.available ? 'Available' : 'Unavailable'}</span>
            </div>
            <div class="actions">
              <button data-action="update" data-id="${v.id}">Update Driver</button>
              <button data-action="toggle" data-id="${v.id}">Change Availability</button>
              <button data-action="delete" data-id="${v.id}" style="border-color:#f1c0c0">Delete Vehicle</button>
            </div>
          `;
          grid.appendChild(card);
        });

        // delegated event handling for action buttons
        grid.querySelectorAll('button').forEach(btn => btn.addEventListener('click', handleCardAction));
      }

      function handleCardAction(ev){
        const id = this.getAttribute('data-id');
        const action = this.getAttribute('data-action');
        const idx = fleet.findIndex(x => x.id === id);
        if(idx === -1) return;

        if(action === 'update'){
          const current = fleet[idx].driver;
          const name = prompt('Enter driver name', current);
          if(name === null) return;
          if(name.trim() === ''){
            alert('Driver name cannot be empty.');
            return;
          }
          fleet[idx].driver = name.trim();
          saveData();
          render();
        } else if(action === 'toggle'){
          fleet[idx].available = !fleet[idx].available;
          saveData();
          render();
        } else if(action === 'delete'){
          if(confirm('Are you sure you want to delete this vehicle?')){
            fleet.splice(idx,1);
            saveData();
            render();
          }
        }
      }

      // storage helpers
      function loadData(){
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if(raw) return JSON.parse(raw);
        } catch(e){}
        return [
          { id:'1', reg:'KA-01-AB-1234', category:'Car', driver:'Ravi', available:true },
          { id:'2', reg:'MH-12-CD-4321', category:'Truck', driver:'Sita', available:false },
          { id:'3', reg:'TN-09-EF-9876', category:'Auto', driver:'Karan', available:true }
        ];
      }
      function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(fleet)); }

      function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
    })();
  </script>
</body>
</html>
